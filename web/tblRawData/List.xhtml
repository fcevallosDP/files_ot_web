<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template.xhtml">

        <ui:define name="title">
            <h:outputText value="DSP Files Upload"></h:outputText>
            
        </ui:define>

        <ui:define name="body">
        <style>
            body{
                overflow-y: hidden !important;
                overflow-x: hidden !important;
            }
            .ui-datatable thead th, .ui-datatable tfoot td { text-align: center !important; }
            .ui-datatable-footer{
                padding: 0px !important;
            }
            .ui-panelgrid.showcase-text-align-center .ui-grid-responsive .ui-panelgrid-cell {
                text-align: center;
            }

            .customPanelGrid .ui-panelgrid-content {
                align-items: center;
            }            

            .ui-filter-column .ui-column-customfilter .custom-filter {
                width: 100%;
                box-sizing: border-box;
            }

        </style>            
            <h:form id="TblRawDataListForm" enctype="multipart/form-data">
                <p:growl id="messages"/>
                <p:panel style="width: 100%;" id="idPanelCabecera">                  
                    <p:panelGrid id="idGridCabecera" columns="4" style="margin:0 auto;width: 60%; border: 1px solid #c8c8c8; border-width: 1px;">                                                        
                        <p:row>
                            <p:column style="text-align:center;background:#083083;color: white;font-size: larger;">
                                <h:outputText value="Pick a Date"/>
                            </p:column>                            
                            <p:column style="text-align:center;background:#083083;color: white;font-size: larger;">
                                <h:outputText value="Upload Files"/>
                            </p:column>                              
                            <p:column style="text-align:center;background:#083083;color: white;font-size: larger;">
                                <h:outputText value="Export"/>
                            </p:column>                            
                            <p:column style="text-align:center;background:#083083;color: white;font-size: larger;">
                                <h:outputText value="Clear"/>
                            </p:column>                            
                        </p:row>
                        <p:row>
                            <p:column style="text-align: center;">
                                <p:datePicker id="disabledDD" value="#{tblRawDataController.DDateSelected}"
                                      readonlyInput="true" 
                                      style="text-align: center; padding: 25px 0px 0px 0px;"
                                      maxdate="#{tblRawDataController.maxDate}" >
                                
                                    <p:ajax event="change" listener="#{tblRawDataController.getItemCalendarByDate()}" 
                                            update="TblRawDataListForm" 
                                            onstart="PF('buiDatatable').show()" oncomplete="PF('buiDatatable').hide()"/>                                   
                                </p:datePicker>
                                <p:commandButton id="idunlock" title="Process again"
                                                 actionListener="#{tblRawDataController.complexLimpiar()}"
                                                 rendered="#{!(empty tblRawDataController.items)}"
                                                 styleClass="mr-2" icon="pi pi-unlock" update="datalist">
                                    <p:confirm header="Confirmation" message="Are you sure you want to upload new data?" icon="pi pi-unlock"/>
                                </p:commandButton>                                
                            </p:column>                        
                            <p:column>
                                <p:fileUpload id="idFile" listener="#{tblRawDataController.handleFileUpload}" 
                                          mode="advanced" sequential="true"
                                          update="datalist, idGridCabecera, messages" sizeLimit="1000000" 
                                          multiple="true" allowTypes="/(\.|\/)(csv|xlsx)$/"
                                          accept=".csv,.xlsx" 
                                          invalidSizeMessage="Maximum file size allowed is 1MB"
                                          invalidFileMessage="only xlsx or csv is allowed" 
                                          >                                    
                                </p:fileUpload>
                                <p:blockUI block="idFile" widgetVar="bui"/>
                            </p:column>                                                            
                            <p:column style="text-align: center; padding: 25px 0px 0px 0px;">
                                <p:commandButton id="btnExpor" icon="pi pi-file-excel" value="Export" ajax="false" title="Excel File" disabled="#{( empty tblRawDataController.items)}">
                                    <p:dataExporter type="xls" target="datalist" fileName="RawDataDSP-#{tblRawDataController.DDateSelected}" exportHeader="true" />
                                </p:commandButton>                                                   
                            </p:column>
                            <p:column style="text-align: center; padding: 25px 0px 0px 0px;">
                                <p:commandButton id="excelButton" icon="pi pi-sync" ajax="false"
                                                 title="Clear"
                                                 actionListener="#{tblRawDataController.simpleLimpiar()}" 
                                                 update="TblRawDataListForm"/>
                            </p:column>                                    
                        </p:row>
                    </p:panelGrid>    
                    <p:blockUI block="datalist" trigger="datalist" widgetVar="buiDatatable">
                        <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
                    </p:blockUI>                    
                    <p:dataTable id="datalist" value="#{tblRawDataController.items}" rows="20"
                                 var="item" widgetVar="WdataList" selectionMode="single"
                                 selection="#{tblRawDataController.selected}"                                 
                                 globalFilterFunction="#{tblRawDataController.globalFilterFunction}" 
                                 filteredValue="#{tblRawDataController.filteredItems}"
                                 emptyMessage="No data found with given criteria"   
                                 rowKey="#{item.id}" paginator="true" paginatorPosition="top"
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                                 rowsPerPageTemplate="20,30,40,{ShowAll|'All'}"
                                 style="width:100%" scrollable="true" resizableColumns="true"   
                                 scrollRows="19" scrollHeight="280"
                                 >
                        <f:facet name="paginatorTopLeft">
                            <div class="flex justify-content-end">
                                <p:inputText id="globalFilter" onkeyup="PF('WdataList').filter()" style="width:200px"
                                             placeholder="Search all fields" />
                            </div>
                        </f:facet>                        
                        <p:column style="text-align: center" headerText="Date" width="60" filterBy="#{item.dDate}" filterMatchMode="contains" filterStyle="display:none" >
                            <h:outputText value="#{item.dDate}">
                                <f:convertDateTime pattern="MM/dd/yyyy" />
                            </h:outputText>
                        </p:column>
                        <p:column width="80" style="text-align: center" headerText="Partner" filterBy="#{item.vPartner}" filterMatchMode="contains" filterStyle="display:none" >                           
                            <h:outputText value="#{item.vPartner}"/>
                        </p:column>
                        <p:column width="200" filterBy="#{item.vCampaign}" headerText="Campaign" filterMatchMode="contains" filterStyle="display:none" >                      
                            <h:outputText value="#{item.vCampaign}"/>
                        </p:column>
                        <p:column width="300" filterBy="#{item.vInsertionOrder}" headerText="Insertion Order" filterMatchMode="contains" filterStyle="display:none" >                         
                            <h:outputText value="#{item.vInsertionOrder}"/>
                        </p:column>
                        <p:column width="300" filterBy="#{item.vLineItem}" headerText="Line Item" filterMatchMode="contains" filterStyle="display:none"  >                         
                            <h:outputText value="#{item.vLineItem}"/>
                        </p:column>
                        <p:column width="200" filterBy="#{item.vExchange}" headerText="Exchange" filterMatchMode="contains" filterStyle="display:none"  >
                            <h:outputText value="#{item.vExchange}"/>
                        </p:column>
                        <p:column width="300" filterBy="#{item.vDealName}" headerText="vDealName" filterMatchMode="contains" filterStyle="display:none">
                            <h:outputText value="#{item.vDealName}"/>
                        </p:column>
                        <p:column width="60" style="white-space: nowrap;text-align: center" headerText="Impressions">
                            <h:outputText value="#{item.iImpressions}"/>
                        </p:column>
                        <p:column width="50" style="white-space: nowrap; text-align: center" headerText="Clicks">
                            <h:outputText value="#{item.iClicks}"/>
                        </p:column>
                        <p:column width="80" style="text-align: right" headerText="Media Spend">
                            <h:outputText value="#{item.dMediaCosts}"/>
                        </p:column>
                        <p:column width="80" style="text-align: right; white-space: wrap;" headerText="Total Media Cost">
                            <h:outputText value="#{item.dTotalMediaCosts}"/>
                        </p:column>
                        <p:column width="80" style="text-align: center" headerText="DSP" filterBy="#{item.vDSP}" filterMatchMode="contains" filterStyle="display:none">
                            <h:outputText value="#{item.vDSP}"/>
                        </p:column>
                        <p:column width="80" filterBy="#{item.vClient}" headerText="Client" filterMatchMode="contains" filterStyle="display:none">
                            <h:outputText value="#{item.vClient}"/>
                        </p:column>
                        <p:column width="80" style="text-align: center" headerText="Agency" filterBy="#{item.vAgency}" filterMatchMode="contains" filterStyle="display:none">
                            <h:outputText value="#{item.vAgency}"/>
                        </p:column>
                        <p:column width="80" filterBy="#{item.vChannel}" headerText="Channel" filterMatchMode="contains" filterStyle="display:none">
                            <h:outputText value="#{item.vChannel}"/>
                        </p:column>
                        <p:column width="40" style="white-space: nowrap;" headerText="Alias" filterBy="#{item.vAlias}" filterMatchMode="contains" filterStyle="display:none">
                            <h:outputText value="#{item.vAlias}"/>
                        </p:column>
                        <p:column width="80" filterBy="#{item.vVendor}" headerText="Vendor" filterMatchMode="contains" filterStyle="display:none">
                            <h:outputText value="#{item.vVendor}"/>                            
                        </p:column>
                        <p:column width="50" style="text-align: center; white-space: wrap;" headerText="Vendor Source" filterBy="#{item.vVendorSource}" filterMatchMode="contains" filterStyle="display:none">
                            <h:outputText value="#{item.vVendorSource}"/>
                        </p:column>
                        <p:column width="30" style="text-align: center" headerText="CPM">
                            <h:outputText value="#{item.dCPM}"/>
                        </p:column>
                        <p:column width="30" style="text-align: center" headerText="CTR">
                            <h:outputText value="#{item.dCTR}"/>
                        </p:column>
                        <p:column width="30" style="text-align: center" headerText="CPC">
                            <h:outputText value="#{item.dCPC}"/>
                        </p:column>
                        <p:column width="30" style="text-align: center" headerText="Year">
                            <h:outputText value="#{item.iAnio}"/>
                        </p:column>
                        <p:column width="30" style="text-align: center" headerText="Month">
                            <h:outputText value="#{item.iMes}"/>
                        </p:column>
                        <p:column width="30" style="text-align: center" headerText="Day">
                            <h:outputText value="#{item.iDia}"/>
                        </p:column>   
                    </p:dataTable>
                    <p:contextMenu for="datalist">
                        <p:menuitem value="EditTag" icon="pi pi-modify" actionListener="#{tblRawDataController.prepareEdit()}" update=":RawEditForm" oncomplete="PF('RawEditDialog').show()"/>
                    </p:contextMenu>                    
                </p:panel>
            </h:form>
            <ui:include src="EditRawData.xhtml"/>
        </ui:define>
    </ui:composition>

</html>
