<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template.xhtml">

        <ui:define name="title">
            <h:outputText value="SSP Files Upload"></h:outputText>
            
        </ui:define>

        <ui:define name="body">
        <style>
            body{
                overflow-y: hidden !important;
                overflow-x: hidden !important;
            }
            .ui-datatable thead th, .ui-datatable tfoot td { text-align: center !important; }
            .ui-datatable-footer{
                padding: 0px !important;
            }
            .ui-panelgrid.showcase-text-align-center .ui-grid-responsive .ui-panelgrid-cell {
                text-align: center;
            }

            .customPanelGrid .ui-panelgrid-content {
                align-items: center;
            }            
        </style>            
            <h:form id="TblRawSSPDataListForm" enctype="multipart/form-data">
                <p:growl id="messages"/>
                <p:panel style="width: 100%;" id="idPanelCabecera">                  
                    <p:panelGrid id="idGridCabecera" columns="4" style="margin:0 auto;width: 60%; border: 1px solid #c8c8c8; border-width: 1px;">                                                        
                        <p:row>
                            <p:column style="text-align:center;background:#083083;color: white;font-size: larger;">
                                <h:outputText value="Pick a Date"/>
                            </p:column>                            
                            <p:column style="text-align:center;background:#083083;color: white;font-size: larger;">
                                <h:outputText value="Upload Files"/>
                            </p:column>                              
                            <p:column style="text-align:center;background:#083083;color: white;font-size: larger;">
                                <h:outputText value="Export"/>
                            </p:column>                            
                            <p:column style="text-align:center;background:#083083;color: white;font-size: larger;">
                                <h:outputText value="Clear"/>
                            </p:column>                            
                        </p:row>
                        <p:row>
                            <p:column style="text-align: center;">
                                <p:datePicker id="disabledDD" value="#{tblRawSSPDataController.DDateSelected}"
                                      readonlyInput="true" 
                                      style="text-align: center; padding: 25px 0px 0px 0px;"
                                      maxdate="#{tblRawSSPDataController.maxDate}" >
                                
                                    <p:ajax event="change" listener="#{tblRawSSPDataController.getItemCalendarByDate()}" 
                                            update="TblRawSSPDataListForm:idGridCabecera, TblRawSSPDataListForm:datalist" 
                                            onstart="PF('buiDatatable').show()" oncomplete="PF('buiDatatable').hide()"/>                                   
                                </p:datePicker>
                                <p:commandButton id="idunlock" title="Process again" onclick="PF('WSSPdataList').clearFilters()"
                                                 actionListener="#{tblRawSSPDataController.complexLimpiar()}"
                                                 rendered="#{!(empty tblRawSSPDataController.items)}"
                                                 styleClass="mr-2" icon="pi pi-unlock" update="datalist">
                                    <p:confirm header="Confirmation" message="Are you sure you want to upload new data?" icon="pi pi-unlock"/>
                                </p:commandButton>                                
                            </p:column>                        
                            <p:column>
                                <p:fileUpload id="idFile" listener="#{tblRawSSPDataController.handleFileUpload}" 
                                          mode="advanced" sequential="true"
                                          update="datalist, idGridCabecera, messages" sizeLimit="1000000" 
                                          multiple="true" allowTypes="/(\.|\/)(csv|xlsx)$/"
                                          accept=".csv,.xlsx" 
                                          invalidSizeMessage="Maximum file size allowed is 1MB"
                                          invalidFileMessage="only xlsx or csv is allowed" 
                                          >                                    
                                </p:fileUpload>
                                <p:blockUI block="idFile" widgetVar="bui"/>
                            </p:column>                                                            
                            <p:column style="text-align: center; padding: 25px 0px 0px 0px;">
                                <p:commandButton icon="pi pi-file-excel" value="Export" ajax="false" title="Excel File" disabled="#{empty tblRawSSPDataController.items}">
                                    <p:dataExporter type="xls" target="datalist" fileName="RawDataSSP-#{tblRawSSPDataController.DDateSelected}" exportHeader="true" />
                                </p:commandButton>                                                   
                            </p:column>
                            <p:column style="text-align: center; padding: 25px 0px 0px 0px;">
                                <p:commandButton id="excelButton" icon="pi pi-sync" 
                                                 ajax="false" title="Clear" onclick="PF('WSSPdataList').clearFilters();"                                                  
                                                 actionListener="#{tblRawSSPDataController.simpleLimpiar()}" 
                                                 update="TblRawSSPDataListForm"/>
                            </p:column>                                    
                        </p:row>
                    </p:panelGrid>    
                    <p:blockUI block="datalist" trigger="datalist" widgetVar="buiDatatable">
                        <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
                    </p:blockUI>                    
                    <p:dataTable id="datalist" value="#{tblRawSSPDataController.items}" var="item"
                                 selectionMode="single" selection="#{tblRawSSPDataController.selected}"
                                 rowKey="#{item.id}" widgetVar="WSSPdataList"
                                 scrollRows="19"
                                 liveScroll="true"
                                 scrollable="true"
                                 scrollHeight="280"
                                 style="width:100%"
                                 resizableColumns="true"
                                 >

                        <p:column style="text-align: center" width="30" >
                            <f:facet name="header">
                                <h:outputText value="Date" />
                            </f:facet>                            
                            <h:outputText value="#{item.dDate}">
                                <f:convertDateTime pattern="MM/dd/yyyy" />
                            </h:outputText>
                        </p:column>
                        <p:column width="80"  style="text-align: center">
                            <f:facet name="header">
                                <h:outputText value="Advertiser" />
                            </f:facet>                            
                            <h:outputText value="#{item.vAdvertiser}"/>
                        </p:column>
                        <p:column width="200" >
                            <f:facet name="header">
                                <h:outputText value="Brand" />
                            </f:facet>                            
                            <h:outputText value="#{item.vBrand}"/>
                        </p:column>
                        <p:column width="300" filterBy="#{item.vDeal}" filterMatchMode="contains" headerText="Deal">                            
                            <h:outputText value="#{item.vDeal}"/>
                        </p:column>
                        <p:column width="50" >
                            <f:facet name="header">
                                <h:outputText value="Device" />
                            </f:facet>                            
                            <h:outputText value="#{item.vDevice}"/>
                        </p:column>
                        <p:column width="50" style="text-wrap: wrap;">
                            <f:facet name="header">
                                <h:outputText value="Gross Margin" />
                            </f:facet>
                            <h:outputText value="#{item.dGrossMargin}"/>
                        </p:column>
                        <p:column width="50" >
                            <f:facet name="header">
                                <h:outputText value="Imps"/>
                            </f:facet>
                            <h:outputText value="#{item.iImpressions}"/>
                        </p:column>
                        <p:column width="50"  style="white-space: wrap;text-align: center">
                            <f:facet name="header">
                                <h:outputText value="Sales Renevue"/>
                            </f:facet>
                            <h:outputText value="#{item.dSalesRevenue}"/>
                        </p:column>
                        <p:column width="50"  style="text-align: right;text-wrap: wrap;">
                            <f:facet name="header">
                                <h:outputText value="Tech Fees"/>
                            </f:facet>
                            <h:outputText value="#{item.dTechFee}"/>
                        </p:column>
                        <p:column width="50"  style="text-align: right;text-wrap: wrap;">
                            <f:facet name="header">
                                <h:outputText value="Media Cost"/>
                            </f:facet>
                            <h:outputText value="#{item.dMediaCost}"/>
                        </p:column>
                        <p:column width="50"  style="text-align: right;text-wrap: wrap;">
                            <f:facet name="header">
                                <h:outputText value="Total Cost"/>
                            </f:facet>
                            <h:outputText value="#{item.dTotalCost}"/>
                        </p:column>
                        <p:column width="50" style="text-align: center" >
                            <f:facet name="header">
                                <h:outputText value="CPM"/>
                            </f:facet>
                            <h:outputText value="#{item.dCPM}"/>
                        </p:column>
                        <p:column width="50" style="text-wrap: wrap;">
                            <f:facet name="header">
                                <h:outputText value="ML Fee"/>
                            </f:facet>
                            <h:outputText value="#{item.dMlFee}"/>
                        </p:column>
                        <p:column width="50" style="text-align: center;text-wrap: wrap;">
                            <f:facet name="header">
                                <h:outputText value="Margin Fee"/>
                            </f:facet>
                            <h:outputText value="#{item.dMarginFee}"/>
                        </p:column>
                        <p:column width="50" style="text-wrap: wrap;">
                            <f:facet name="header">
                                <h:outputText value="DSP Fee"/>
                            </f:facet>
                            <h:outputText value="#{item.dDspFee}"/>
                        </p:column>
                        <p:column width="50" style="white-space: wrap;">
                            <f:facet name="header">
                                <h:outputText value="Gross Revenue"/>
                            </f:facet>
                            <h:outputText value="#{item.dGrossRevenue}"/>
                        </p:column>
                        <p:column width="50" style="white-space: wrap;">
                            <f:facet name="header">
                                <h:outputText value="Net Revenue"/>
                            </f:facet>
                            <h:outputText value="#{item.dNetRevenue}"/>
                        </p:column>
                        <p:column width="100"  style="text-align: center">
                            <f:facet name="header">
                                <h:outputText value="Client"/>
                            </f:facet>
                            <h:outputText value="#{item.vClient}"/>
                        </p:column>
                        <p:column width="80"  style="text-align: center">
                            <f:facet name="header">
                                <h:outputText value="Channel"/>
                            </f:facet>
                            <h:outputText value="#{item.vChannel}"/>
                        </p:column>
                        <p:column width="100"  style="text-align: center" filterBy="#{item.vDsp}" filterMatchMode="contains" headerText="DSP">
                            <h:outputText value="#{item.vDsp}"/>
                        </p:column>
                        <p:column width="100"  style="text-align: center">
                            <f:facet name="header">
                                <h:outputText value="Agency"/>
                            </f:facet>
                            <h:outputText value="#{item.vAgency}"/>
                        </p:column>
                        <p:column width="30"  style="text-align: center">
                            <f:facet name="header">
                                <h:outputText value="Year"/>
                            </f:facet>
                            <h:outputText value="#{item.iYear}"/>
                        </p:column>
                        <p:column width="30"  style="text-align: center">
                            <f:facet name="header">
                                <h:outputText value="Month"/>
                            </f:facet>
                            <h:outputText value="#{item.iMonth}"/>
                        </p:column>
                        <p:column width="30"  style="text-align: center">
                            <f:facet name="header">
                                <h:outputText value="Day"/>
                            </f:facet>
                            <h:outputText value="#{item.iDay}"/>
                        </p:column>   
                        <p:column width="100"  style="text-align: center">
                            <f:facet name="header">
                                <h:outputText value="Seat"/>
                            </f:facet>
                            <h:outputText value="#{item.vSeat}"/>
                        </p:column>   
                        <p:column width="100"  style="text-align: center">
                            <f:facet name="header">
                                <h:outputText value="Exchange"/>
                            </f:facet>
                            <h:outputText value="#{item.vExchange}"/>
                        </p:column>   
                        <p:column width="50"  style="text-align: center; white-space: wrap;">
                            <f:facet name="header">
                                <h:outputText value="SSP Margin"/>
                            </f:facet>
                            <h:outputText value="#{item.dMargin}"/>
                        </p:column>   
                        <p:column width="50"  style="text-align: center; white-space: wrap;">
                            <f:facet name="header">
                                <h:outputText value="NET SSP Margin"/>
                            </f:facet>
                            <h:outputText value="#{item.dNetMargin}"/>
                        </p:column>   
                        <f:facet name="footer"><h:outputText id="idFooter" rendered="#{!(empty tblRawSSPDataController.items)}" value="#{tblRawSSPDataController.items.size()} rows" style="float: right"/></f:facet>
                    </p:dataTable>
                    <p:contextMenu for="datalist">
                        <p:menuitem value="EditTag" icon="pi pi-modify" actionListener="#{tblRawSSPDataController.prepareEdit()}" update=":RawSSPEditForm" oncomplete="PF('RawSSPEditDialog').show()"/>
                    </p:contextMenu>                     
                </p:panel>
            </h:form>
            <ui:include src="EditRawSSPData.xhtml"/>
        </ui:define>
    </ui:composition>

</html>
